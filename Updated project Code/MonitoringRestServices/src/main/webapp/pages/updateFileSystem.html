<script>
	$(document).ready(function() {
		getUpdateFileSystemNames();
	});
	var mTime = null;
	function updateTime() {
		mTime = Date.now().toString();
	}
	var fileSystemName;
	function loadPanel(insertFSData) {
		$.each(insertFSData, function(i, item) {
			$("#updateFSForm").find("#fileId").val(insertFSData.id);
			//$("#updateFileSystemNames").val(insertFSData.fsName);
			fileSystemName = insertFSData.fsName;
			$("#updateFSForm").find("#fileHost").val(insertFSData.fsHost);
			$("#updateFSForm").find("#fileMount").val(insertFSData.fsMount);
			$("#updateFSForm").find("#filePath").val(insertFSData.fsPath);
		});
	}

	$(function() {
		$('#updateFSForm')
				.validate(
						{
							rules : {
								updateFileSystemNames : {
									required : true
								},

								fileHost : {
									required : true
								},
								fileMount : {
									required : true
								},
							},
							messages : {
								updateFileSystemNames : {
									required : "Please select File System Name",
								},
								fileHost : {
									required : "Please Enter Host Name"
								},
								fileMount : {
									required : "Please Enter File System Mount"
								},
							},

							submitHandler : function(form) {
								var updateFSData = {};
								updateFSData.id = $("#fileId").val();
								updateFSData.fsName = $(
										"#updateFileSystemNames").val();
								updateFSData.fsHost = $("#fileHost").val();
								updateFSData.fsMount = $("#fileMount").val();
								updateFSData.fsPath = $("#filePath").val();
								$
										.ajax({
											type : "POST",
											contentType : "application/json; charset=utf-8",
											url : '/MonitoringRestServices/rest/updateFileSystem',
											data : JSON.stringify(updateFSData),
											headers : getHeadersData(),
											success : function(msg) {
												if (msg.code == 200) {
													var result = '<p class="successMessage">'
															+ msg.message
															+ '</p>';
													$("#rightpanel")
															.load(
																	"pages/fileSystemsList.html",
																	function() {
																		$(
																				"#fsListResults")
																				.html(
																						result);
																		$(
																				"#fsListResults")
																				.removeClass(
																						"alert alert-danger");
																		$(
																				"#fsListResults")
																				.addClass(
																						"alert alert-success");
																	});

												} else {

													var result = '<p class="failureMessage">'
															+ msg.message
															+ '</p>';
													$("#rightpanel")
															.load(
																	"pages/fileSystemsList.html",
																	function() {
																		$(
																				"#fsListResults")
																				.html(
																						result);
																		$(
																				"#fsListResults")
																				.removeClass(
																						"alert alert-success");
																		$(
																				"#fsListResults")
																				.addClass(
																						"alert alert-danger");
																	});
												}
											},
											failure : function(xhr) {
												var result = '<p class="failureMessage">'
														+ xhr.toString()
														+ '</p>';
												$("#rightpanel")
														.load(
																"pages/fileSystemsList.html",
																function() {
																	$(
																			"#fsListResults")
																			.html(
																					result);
																	$(
																			"#fsListResults")
																			.removeClass(
																					"alert alert-success");
																	$(
																			"#fsListResults")
																			.addClass(
																					"alert alert-danger");
																});
											},
											dataType : "json"
										});
							}
						});
	});

	$('#fileDelete')
			.bind(
					'click',
					function() {
						var deleteFSData = $("#fileId").val();
						var isDelete = deleteIt();
						if (isDelete) {
							$
									.ajax({
										type : "PUT",
										contentType : "application/json; charset=utf-8",
										url : '/MonitoringRestServices/rest/deleteFileSystemDetails/'
												+ deleteFSData,
										headers : getHeadersData(),
										success : function(msg) {
											if (msg.code == 200) {
												var result = '<p class="successMessage">'
														+ msg.message + '</p>';
												$("#rightpanel")
														.load(
																"pages/fileSystemsList.html",
																function() {
																	$(
																			"#fsListResults")
																			.html(
																					result);
																	$(
																			"#fsListResults")
																			.removeClass(
																					"alert alert-danger");
																	$(
																			"#fsListResults")
																			.addClass(
																					"alert alert-success");
																});
											} else {
												var result = '<p class="failureMessage">'
														+ msg.message + '</p>';
												$("#rightpanel")
														.load(
																"pages/fileSystemsList.html",
																function() {
																	$(
																			"#fsListResults")
																			.html(
																					result);
																	$(
																			"#fsListResults")
																			.removeClass(
																					"alert alert-success");
																	$(
																			"#fsListResults")
																			.addClass(
																					"alert alert-danger");
																});
											}
										},
										failure : function(xhr) {
											var result = '<p class="failureMessage">'
													+ xhr.toString() + '</p>';
											$("#rightpanel")
													.load(
															"pages/fileSystemsList.html",
															function() {
																$(
																		"#fsListResults")
																		.html(
																				result);
																$(
																		"#fsListResults")
																		.removeClass(
																				"alert alert-success");
																$(
																		"#fsListResults")
																		.addClass(
																				"alert alert-danger");
															});
										}
									});
						} else {
							console.log("ELSE....Not deleted");
						}
					});

	var getUpdateFileSystemNames = null;
	function getUpdateFileSystemNames() {
		updateTime();
		$.ajax({
			type : "GET",
			contentType : "application/json; charset=utf-8",
			url : "/MonitoringRestServices/rest/fileNamesList" + "?mtime="
					+ mTime,
			dataType : "json",
			headers : getHeadersData(),
			success : function(responseData) {
				getUpdateFileSystemNames = responseData;
				$("#updateFileSysNamesResult").html("");
				$("#updateFSData tbody").html("");
				if (responseData.length > 0) {
					$.each(responseData, function() {
						$("#updateFileSystemNames").append(
								$("<option></option>").val(this['fileName'])
										.html(this['fileName']));
					});

					$("#updateFileSystemNames option").each(function(i) {
						if ($(this).val() == fileSystemName) {
							$(this).attr("selected", "selected");
						}
					});
				} else {

				}
				$('input, search').placeholder();
			},
			failure : function(errMsg) {
				var result = '<p class="failureMessage">' + xhr.toString()
						+ '</p>';
				$("#updateFileSysNamesResult").html(result);
				$("#updateFileSysNamesResult").addClass("alert alert-danger");
			}
		});
	}
	$('#updateFileSystemNames').on(
			'change',
			function() {
				var ufsName = this.value;
				console.log("fsName selected" + ufsName);
				console.log("getFileSystemNames"
						+ JSON.stringify(getUpdateFileSystemNames));
				if (getUpdateFileSystemNames.length != 0) {
					for ( var i in getUpdateFileSystemNames) {
						console.log("i.fileName"
								+ getUpdateFileSystemNames[i].fileName);
						if (getUpdateFileSystemNames[i].fileName == ufsName) {
							$("#filePath").val(
									getUpdateFileSystemNames[i].fsPath);
							break;
						} else {
							$("#filePath").val("");
						}
					}
				}

			});
	$("#fileCancel").bind('click', function() {
		$("#rightpanel").load("pages/fileSystemsList.html");
	});
</script>

<h2>Update File Systems</h2>
<div id="updateFS">
	<form id="updateFSForm" class="form-inline" action="" method="post">
		<table class="updateFSData table">
			<tbody>
				<tr>
					<td><label>File System Name</label> <br> <select
						name="updateFileSystemNames" id="updateFileSystemNames"
						class="form-control">
							<option value=""></option>
					</select></td>
				</tr>
				<tr>
					<td><label>Host Name</label><br> <input type="text"
						name="fileHost" class="form-control" id="fileHost" /></td>
				</tr>
				<tr>
					<td><label>Mount</label><br> <input type="text"
						class="form-control" name="fileMount" id="fileMount" /></td>
				</tr>
				<tr>
					<td><label>Path</label><br> <input type="text"
						name="filePath" class="form-control" id="filePath" readonly /></td>
				</tr>
				<tr>
					<td><input type="submit" name="fileUpdate"
						class="btn btn-primary" id="fileUpdate" value="Update" /> <input
						type="button" name="fileDelete" class="btn btn-danger"
						id="fileDelete" value="Delete" /> <input type="button"
						id="fileCancel" name="fileCancel" class="btn btn-info"
						value="Cancel" /></td>

				</tr>
				<tr style="display: none;">
					<td><input name="fileId" id="fileId" class="form-control"
						value="" /></td>
				</tr>
			</tbody>
		</table>
	</form>
</div>
<div id="updateFileSysNamesResult"></div>