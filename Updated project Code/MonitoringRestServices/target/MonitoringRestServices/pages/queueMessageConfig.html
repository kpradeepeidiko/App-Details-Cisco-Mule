<script>
var mTime = null;
function updateTime(){
	mTime = Date.now().toString();
}
var queueConfigExist = null;
$(document).ready(function() {
	getQueueConfig();
});
	
function getQueueConfig(){
	updateTime();	
	$.ajax({
			type : "GET",
			contentType : "application/json; charset=utf-8",
			url : "/MonitoringRestServices/rest/getQueueCfgn?mtime="+mTime,
			dataType : "json",
			headers : getHeadersData(),
	
	success : function(responseData) {
						if (responseData.id != 0) {
							$("#queueConfigid").val(responseData.id);
							$("#queueConfigName").val(responseData.name);
							$("#queueConfigHost").val(responseData.host);
							$("#queueConfigQueueType").val(responseData.queue);
							$("#queueConfigSvrConn").val(responseData.svrConn);
							$("#queueConfigPort").val(
									responseData.listener_port);
							$("#qmConfigForm :input").attr("readonly", true);
							$("#qformEditBtn").show();
							$("#qformAddBtn").hide();
							$("#qformSubmit").hide();
							queueConfigExist = true;
						} else {
							var html = '<p class="failureMessage">No config data found, add a configuration</p>';
							$("#queueConfigResult").html(html);
							$("#queueConfigResult").addClass(
									"alert alert-danger");
							$("#qmConfigForm :input").attr("readonly", false);
							$("#qformEditBtn").hide();
							$("#qformSubmit").hide();
							$("#qformAddBtn").show();
							queueConfigExist = false;
						}
					},
					failure : function(errMsg) {
						$("#qmConfigForm").hide();
						var html = '<p class="failureMessage"> Failure: '
								+ errMsg.toString() + '</p>';
						$("#queueConfigResult").html(html);
						$("#queueConfigResult").addClass("alert alert-danger");
					}
				});
	};

	$(function() {

		$('#qmConfigForm')
				.validate(
						{

							rules : {
								queueConfigName : {
									required : true
								},
								queueConfigHost : {
									required : true
								},
								queueConfigQueueType : {
									required : true
								},
								queueConfigSvrConn : {
									required : true
								},
								queueConfigPort : {
									required : true
								},
							},
							messages : {
								queueConfigName : {
									required : "Please Enter Queue Name"
								},
								queueConfigHost : {
									required : "Please Enter Host Name"
								},
								queueConfigQueueType : {
									required : "Please Enter Queue"
								},
								queueConfigSvrConn : {
									required : "Please Enter Server Connection"
								},
								queueConfigPort : {
									required : "Please Enter Listener Port Number"
								},
							},

							submitHandler : function(form) {
								var id = $("#queueConfigid").val();
								var queueConfigData = {};
								var urlPath = null;

								queueConfigData.name = $("#queueConfigName")
										.val();
								queueConfigData.host = $("#queueConfigHost")
										.val();
								queueConfigData.queue = $(
										"#queueConfigQueueType").val();
								queueConfigData.svrConn = $(
										"#queueConfigSvrConn").val();
								queueConfigData.listener_port = $(
										"#queueConfigPort").val();

								if (queueConfigExist) {

									queueConfigData.id = $("#queueConfigid")
											.val();
									urlPath = '/MonitoringRestServices/rest/updateQueueCfg';
								} else {
									urlPath = '/MonitoringRestServices/rest/addQueueCfg';

								}

								$
										.ajax({

											type : "POST",
											contentType : "application/json; charset=utf-8",
											url : urlPath,
											data : JSON
													.stringify(queueConfigData),
											dataType : "json",
											headers : getHeadersData(),
											success : function(msg) {
												if (msg.code == 200) {
													var html = '<p class="successMessage">'
															+ msg.message
															+ '</p>';
													$("#qmConfigPage")
															.load(
																	"pages/queueMessageConfig.html",
																	function() {
																		$(
																				"#queueConfigResult")
																				.html(
																						html);
																		$(
																				"#queueConfigResult")
																				.addClass(
																						"alert alert-success");
																		$(
																				"#qmConfigForm :input")
																				.attr(
																						"readonly",
																						true);
																		$(
																				"#qformEditBtn")
																				.hide();
																		$(
																				"#qformSubmit")
																				.show();
																		$(
																				"#qformAddBtn")
																				.hide();
																	});
												} else {
													var html = '<p class="failureMessage">'
															+ msg.message
															+ '</p>';
													$("#qmConfigPage")
															.load(
																	"pages/queueMessageConfig.html",
																	function() {
																		$(
																				"#queueConfigResult")
																				.html(
																						html);
																		$(
																				"#queueConfigResult")
																				.addClass(
																						"alert alert-danger");
																		$(
																				"#qmConfigForm :input")
																				.attr(
																						"readonly",
																						false);
																		$(
																				"#qformEditBtn")
																				.hide();
																		$(
																				"#qformSubmit")
																				.show();
																		$(
																				"#qformAddBtn")
																				.hide();
																	});
												}
											},
											failure : function(errMsg) {
												var html = '<p class="failureMessage"> Failure: '
														+ errMsg.toString()
														+ '</p>';
												$("#queueConfigResult").html(
														html);
												$("#queueConfigResult")
														.addClass(
																"alert alert-danger");
												$("#qmConfigForm :input").attr(
														"readonly", false);
												$("#qformEditBtn").hide();
												$("#qformSubmit").show();
												$("#qformAddBtn").hide();
											}
										});
							}
						});
	});

	$("#qformEditBtn").bind('click', function() {
		$("#queueConfigResult").html("");
		$("#queueConfigResult").removeClass("alert alert-success");
		$("#queueConfigResult").removeClass("alert alert-danger");
		$("#qmConfigForm :input").attr("readonly", false);
		$("#qformEditBtn").hide();
		$("#qformSubmit").show();
		$("#qformAddBtn").hide();
	});
</script>

<h2>Queue Alert Configuration</h2>
<div id="qmConfig">
	<form id="qmConfigForm" action="" class="form-inline" method="post">
		<table class="t1 table">
			<tbody>
				<tr>
				    <td style="display:none;"><input type="text" name="queueConfigid" id="queueConfigid"  class="form-control" value="" /></td>
					<td><label>Queue Manager Name</label><br> 
					   <input type="text" class="form-control" name="queueConfigName" id="queueConfigName" readonly/>
					</td> 
					<td colspan="2"><label>Host Name</label><br>
					    <input type="text" name="queueConfigHost" class="form-control" id="queueConfigHost" readonly/>
					</td>
				</tr>
				<tr>
					<td><label>Queue Name</label><br>
						<input type="text" class="form-control" name="queueConfigQueueType" id="queueConfigQueueType" readonly/>
					</td>
						 
					<td><label>Server Connection</label><br>
						<input type="text" name="queueConfigSvrConn" class="form-control" id="queueConfigSvrConn" readonly/>
					</td>

					<td><label>Listener Port</label><br> 
						<input type="text" name="queueConfigPort" class="form-control" id="queueConfigPort" readonly/>
					</td>
				</tr>
				<tr>
					<td colspan="3">
						<input id="qformEditBtn" type="button" name="formEditBtn" class="btn btn-primary"
						value="Edit" style="display:none;"/>
						<input id="qformAddBtn" type="submit" name="formAddBtn" class="btn btn-primary"
						value="Add" style="display:none;"/>
						<input id="qformSubmit" type="submit" name="formSubmit" class="btn btn-primary"
						value="submit" style="display:none;"/>
					</td> 
				</tr>
		</table>
	</form>
	<div id="queueConfigResult" class="queueConfigResult"></div>
</div>