<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:dw="http://www.mulesoft.org/schema/mule/ee/dw"
	xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:spring="http://www.springframework.org/schema/beans" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.mulesoft.org/schema/mule/ee/dw http://www.mulesoft.org/schema/mule/ee/dw/current/dw.xsd
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-current.xsd
http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd">
<choice-exception-strategy name="GlobalExceptionStrategy">
			<catch-exception-strategy
				when="#[exception.causedBy(org.mule.api.expression.ExpressionRuntimeException)||exception.causedBy(org.mule.api.MuleRuntimeException)]"
				doc:name="Runtime Exception Strategy" logException="false">
				<logger message="In Runtime Exception Strategy " level="INFO"
					doc:name="Logger" />
				<set-variable variableName="exceptionMessage" value="#[exception.cause.message]"
					doc:name="Exception Message" />
				<set-variable variableName="exceptionIntegrationId"
					value="#[flowVars.integrationId]" doc:name="Set Integration Id" />
				<set-variable variableName="exceptionUserId" value="#[flowVars.userId]"
					doc:name="Set User Id" />
				<dw:transform-message doc:name="Build Logging Input Message">
					<dw:set-variable
						resource="classpath:dwScripts/buildExceptionLoggingRequest.dwl"
						variableName="result" />

				</dw:transform-message>

				<flow-ref name="coreServicesLoggingFlow" doc:name="coreServicesLoggingFlow" />
				<dw:transform-message doc:name="Build Alert Input Message">
					<dw:set-payload
						resource="classpath:dwScripts/buildAlertRuntimeExceptionRequest.dwl" />

				</dw:transform-message>
				<flow-ref name="coreServicesAlertsFlow" doc:name="coreServicesAlertsFlow" />
			</catch-exception-strategy>
			<catch-exception-strategy
				when="#[exception.causedBy(org.mule.module.http.internal.request.ResponseValidatorException)]"
				doc:name="HTTP Validator Exception Strategy" logException="false">
				<set-variable variableName="exceptionIntegrationId"
					value="#[flowVars.integrationId]" doc:name="Set Integration Id" />
				<set-variable variableName="exceptionUserId" value="#[flowVars.userId]"
					doc:name="Set User Id" />
				<set-variable variableName="exceptionMessage" value="#[exception.message]"
					doc:name="Exception Message" />
				<dw:transform-message doc:name="Build Logging Input Message">
					<dw:set-variable
						resource="classpath:dwScripts/buildExceptionLoggingRequest.dwl"
						variableName="result" />

				</dw:transform-message>

				<flow-ref name="coreServicesLoggingFlow" doc:name="coreServicesLoggingFlow" />
				<dw:transform-message doc:name="Build Alert Input Message">
					<dw:set-payload
						resource="classpath:dwScripts/buildAlertHttpValidatorExceptionRequest.dwl" />

				</dw:transform-message>
				<flow-ref name="coreServicesAlertsFlow" doc:name="coreServicesAlertsFlow" />
			</catch-exception-strategy>
        <catch-exception-strategy when="#[exception.causedBy(java.util.concurrent.TimeoutException)]" doc:name="Time out Exception Strategy" logException="false">
            <logger message="Time out Exception #[exception.message]" level="INFO" doc:name="Logger"/>
        </catch-exception-strategy>
        <catch-exception-strategy doc:name="Default Catch Exception Strategy" logException="false">
            <logger message="Ddefault Exception #[exception.message]" level="INFO" doc:name="Logger"/>
        </catch-exception-strategy>
		</choice-exception-strategy>

</mule>
